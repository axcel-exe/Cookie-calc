<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>HTML Calculator</title>
    <style>
        :root {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
            --bg: #1e1f23;
            --panel: #2b2d31;
            --accent: #4caf50;
            --btn: #3a3c40;
            --text: #e6e6e6
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, #0f1720, #111217)
        }

        .calc {
            width: 320px;
            background: var(--panel);
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 6px 30px rgba(0, 0, 0, .6)
        }

        .display {
            height: 64px;
            background: var(--bg);
            color: var(--text);
            font-size: 1.6rem;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-end;
            overflow: hidden;
            word-wrap: anywhere
        }

        .small {
            font-size: .8rem;
            color: #9aa0a6;
            opacity: .9
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 12px
        }

        button {
            height: 56px;
            border-radius: 8px;
            border: 0;
            background: var(--btn);
            color: var(--text);
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: inset 0 -3px rgba(0, 0, 0, .2)
        }

        button.operator {
            background: linear-gradient(180deg, #ffb866, #ff9f3b);
            color: #111
        }

        button.equal {
            background: var(--accent);
            color: #04110b;
            grid-column: span 2
        }

        button.clear {
            background: #d9534f;
            color: #fff
        }

        button:active {
            transform: translateY(1px)
        }
    </style>
</head>

<body>
    <div class="calc" role="application" aria-label="Calculator">
        <div class="display" id="display" aria-live="polite">
            <div class="small" id="expr">&nbsp;</div>
            <div id="result">0</div>
        </div>
        <div class="grid" id="keys">
            <button class="clear" data-action="clear">C</button>
            <button data-action="back">⌫</button>
            <button data-value="(">(</button>
            <button data-value=")" class="operator">)</button>

            <button data-value="7">7</button>
            <button data-value="8">8</button>
            <button data-value="9">9</button>
            <button data-value="/" class="operator">÷</button>

            <button data-value="4">4</button>
            <button data-value="5">5</button>
            <button data-value="6">6</button>
            <button data-value="*" class="operator">×</button>

            <button data-value="1">1</button>
            <button data-value="2">2</button>
            <button data-value="3">3</button>
            <button data-value="-" class="operator">−</button>

            <button data-value="0" style="grid-column:span 2">0</button>
            <button data-value=".">.</button>
            <button data-value="+" class="operator">+</button>

            <button data-action="neg">+/-</button>
            <button class="equal" data-action="equals">=</button>
        </div>
    </div>

    <script>
        const exprEl = document.getElementById('expr');
        const resultEl = document.getElementById('result');
        let expr = '';

        function refresh() {
            exprEl.textContent = expr || '\xa0';
            resultEl.textContent = expr ? expr : '0';
        }

        function sanitizeForEval(s) {
            if (!/^[0-9+\-*/().\s]+$/.test(s)) throw new Error('Invalid chars');
            return s;
        }

        function compute(s) {
            try {
                const safe = sanitizeForEval(s);
                // replace unicode operator glyphs if present
                const normalized = safe.replace(/×/g, '*').replace(/÷/g, '/').replace(/−/g, '-');
                // prevent leading zeros like "00" causing octal — using Function is fine here after validation
                return Function('"use strict";return (' + normalized + ')')();
            } catch {
                return 'Error';
            }
        }

        document.getElementById('keys').addEventListener('click', e => {
            const btn = e.target.closest('button');
            if (!btn) return;
            const v = btn.getAttribute('data-value');
            const action = btn.getAttribute('data-action');

            if (action === 'clear') { expr = ''; refresh(); return; }
            if (action === 'back') { expr = expr.slice(0, -1); refresh(); return; }
            if (action === 'equals') {
                const res = compute(expr);
                expr = res === 'Error' ? '' : String(res);
                refresh();
                return;
            }
            if (action === 'neg') {
                if (!expr) return;
                // toggle leading negative of the last number
                expr = expr.replace(/(\d+(\.\d+)?)$/, m => (m.startsWith('-') ? m.slice(1) : '-' + m));
                refresh();
                return;
            }
            if (v) {
                // avoid multiple operators in a row
                if (/^[+\-*/.]$/.test(v) && /[+\-*/.]$/.test(expr)) {
                    // replace last operator
                    expr = expr.slice(0, -1) + v;
                } else {
                    expr += v;
                }
                refresh();
            }
        });

        // keyboard support
        window.addEventListener('keydown', e => {
            if (e.key === 'Enter') { e.preventDefault(); document.querySelector('[data-action="equals"]').click(); return; }
            if (e.key === 'Backspace') { e.preventDefault(); document.querySelector('[data-action="back"]').click(); return; }
            if (e.key === 'Escape') { document.querySelector('[data-action="clear"]').click(); return; }
            if (/^[0-9+\-*/().]$/.test(e.key)) {
                const btn = [...document.querySelectorAll('[data-value]')].find(b => b.getAttribute('data-value') === e.key);
                if (btn) btn.click();
            }
        });

        // live evaluation (optional)
        setInterval(() => {
            if (!expr) { resultEl.textContent = '0'; return; }
            const res = compute(expr);
            resultEl.textContent = res === 'Error' ? 'Error' : res;
        }, 400);

        refresh();
    </script>
</body>

</html>
